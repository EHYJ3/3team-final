<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.javalab.board.repository.JobPostMapper">

    <insert id="insertJobPost" parameterType="com.javalab.board.vo.JobPostVo">
        <selectKey keyProperty="jobPostId" resultType="long" order="BEFORE">
            SELECT JOBPOST_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO JOBPOST (
        jobPost_id, title, content, education, experience, position, address, salary, end_date, hit_no, created, comp_id
        ) VALUES (
        #{jobPostId}, #{title}, #{content}, #{education}, #{experience}, #{position}, #{address, jdbcType=VARCHAR}, #{salary, jdbcType=VARCHAR}, #{endDate}, 0, SYSDATE, #{compId}
        )
    </insert>



    <select id="getJobPostById" resultType="com.javalab.board.vo.JobPostVo">
        SELECT * FROM jobPost WHERE jobPost_id = #{jobPostId}
    </select>

    <select id="getAllJobPosts" resultType="com.javalab.board.vo.JobPostVo">
        SELECT * FROM jobPost
    </select>

    <select id="selectJobPostsByCompany" parameterType="String" resultType="com.javalab.board.vo.JobPostVo">
        SELECT * FROM jobPost
        WHERE comp_id = #{compId}
    </select>

    <update id="updatePaymentStatus">
        UPDATE jobPost
        SET payment_status = #{paymentStatus}
        WHERE jobPost_id = #{jobPostId}
    </update>

    <select id="findJobPostById" parameterType="long" resultType="com.javalab.board.vo.JobPostVo">
        SELECT * FROM jobPost
        WHERE jobPost_id = #{jobPostId}
    </select>

    <select id="getScrapList" parameterType="string"
            resultType="com.javalab.board.vo.JobPostVo">
        SELECT j.jobPost_id, j.title, j.created, k.jobSeeker_id
        FROM jobSeekerScrap s
        JOIN jobPost j ON s.jobPost_id = j.jobPost_id
        JOIN jobSeeker k ON s.jobSeeker_id = k.jobSeeker_id
        WHERE s.jobSeeker_id = #{jobSeekerId}

    </select>

    <!-- jobPostId로 공고 정보 가져오기 -->
    <select id="getJobPostDetailsById" resultType="com.javalab.board.vo.JobPostVo">
        SELECT title, salary, address, end_date
        FROM jobPost
        WHERE jobPost_id = #{jobPostId}
    </select>

    <update id="updateJobPost" parameterType="com.javalab.board.vo.JobPostVo">
        UPDATE jobPost
        SET title = #{title, jdbcType=VARCHAR},
        content = #{content, jdbcType=VARCHAR},
        position = #{position, jdbcType=VARCHAR},
        salary = #{salary, jdbcType=VARCHAR},
        experience = #{experience, jdbcType=VARCHAR},
        education = #{education, jdbcType=VARCHAR},
        address = #{address, jdbcType=VARCHAR},
        end_date = #{endDate, jdbcType=DATE},
        homepage = #{homepage, jdbcType=VARCHAR}
        WHERE jobPost_id = #{jobPostId, jdbcType=BIGINT}
    </update>

    <delete id="deleteJobPost">
        DELETE FROM jobPost
        WHERE jobPost_id = #{jobPostId}
    </delete>

    <select id="findCompanyByCompId" parameterType="String" resultType="com.javalab.board.vo.CompanyVo">
        SELECT * FROM company WHERE comp_id = #{compId}
    </select>

</mapper>
